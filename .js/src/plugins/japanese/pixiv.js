var e=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{u(i.next(e))}catch(e){o(e)}}function a(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((i=i.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,i,n,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),i=require("@libs/defaultCover"),n=function(){function n(){this.id="pixiv.series.input",this.name="Pixiv Novels",this.icon="src/jp/pixiv/icon.png",this.site="https://www.pixiv.net",this.version="1.1.0",this.headers={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Cookie:["PHPSESSID=","device_token=","privacy_policy_agreement=","p_ab_id=","p_ab_id_2=","p_ab_d_id="].join("; ")},this.filters={}}return n.prototype.popularNovels=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){return[2,[]]}))}))},n.prototype.searchNovels=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){return[2,[]]}))}))},n.prototype.extractNextData=function(e){var t=e.match(/<script id="__NEXT_DATA__"[^>]*>([\s\S]*?)<\/script>/);if(!t)throw new Error("Pixiv blocked request (missing __NEXT_DATA__). Check cookie.");return JSON.parse(t[1])},n.prototype.parseNovel=function(r){return e(this,void 0,void 0,(function(){return t(this,(function(e){if(r.includes("/novel/show.php"))return[2,this.parseSingleNovel(r)];if(r.includes("/novel/series/"))return[2,this.parseSeries(r)];throw new Error("Unsupported Pixiv URL")}))}))},n.prototype.parseSeries=function(n){return e(this,void 0,void 0,(function(){var e,o,s,a,u;return t(this,(function(t){switch(t.label){case 0:return[4,(0,r.fetchApi)(this.site+n,{headers:this.headers})];case 1:return[4,t.sent().text()];case 2:if(e=t.sent(),o=this.extractNextData(e),!(null==(s=null===(u=null==o?void 0:o.props)||void 0===u?void 0:u.pageProps)?void 0:s.series)||!(null==s?void 0:s.seriesContents))throw new Error("Failed to load Pixiv series (cookie issue)");return a=s.seriesContents.map((function(e){return{name:e.title,path:"/novel/show.php?id=".concat(e.id),releaseTime:""}})),[2,{path:n,name:s.series.title,author:s.series.userName,artist:"",cover:s.series.coverUrl||i.defaultCover,summary:s.series.description||"",genres:"",status:"",chapters:a}]}}))}))},n.prototype.parseSingleNovel=function(n){return e(this,void 0,void 0,(function(){var e,o,s,a,u;return t(this,(function(t){switch(t.label){case 0:return[4,(0,r.fetchApi)(this.site+n,{headers:this.headers})];case 1:return[4,t.sent().text()];case 2:if(e=t.sent(),o=this.extractNextData(e),!(s=null===(u=null===(a=null==o?void 0:o.props)||void 0===a?void 0:a.pageProps)||void 0===u?void 0:u.novel))throw new Error("Failed to load Pixiv novel (cookie issue)");return[2,{path:n,name:s.title,author:s.userName,artist:"",cover:s.coverUrl||i.defaultCover,summary:s.description||"",genres:"",status:"",chapters:[{name:s.title,path:n,releaseTime:""}]}]}}))}))},n.prototype.parseChapter=function(i){return e(this,void 0,void 0,(function(){var e,n,o,s,a,u;return t(this,(function(t){switch(t.label){case 0:return[4,(0,r.fetchApi)(this.site+i,{headers:this.headers})];case 1:return[4,t.sent().text()];case 2:if(e=t.sent(),n=this.extractNextData(e),!(null==(o=null===(u=null===(a=null==n?void 0:n.props)||void 0===a?void 0:a.pageProps)||void 0===u?void 0:u.novel)?void 0:o.text))throw new Error("Failed to load Pixiv chapter text");return s=o.text.split("\n").map((function(e){return"<p>".concat(e,"</p>")})).join(""),[2,"<h1>".concat(o.title,"</h1>").concat(s)]}}))}))},n.prototype.resolveUrl=function(e){return this.site+e},n}();exports.default=new n;